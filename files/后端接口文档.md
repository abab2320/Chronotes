# Chronotes 后端接口文档

## 目录
- [Chronotes 后端接口文档](#chronotes-后端接口文档)
  - [目录](#目录)
  - [1. 通用说明](#1-通用说明)
    - [1.1 统一响应结构](#11-统一响应结构)
    - [1.2 通用约定](#12-通用约定)
  - [2. 认证模块 `/api/auth`](#2-认证模块-apiauth)
    - [2.2 发送验证码](#22-发送验证码)
    - [2.3 用户注册](#23-用户注册)
  - [附录](#附录)
    - [A. 校验规则参考](#a-校验规则参考)
    - [B. cURL 调用示例](#b-curl-调用示例)
  - [更新日志](#更新日志)

---

## 1. 通用说明

### 1.1 统一响应结构

所有接口均返回统一封装的 `Result<T>` 结构：

```typescript
{
  "code": number,      // 状态码：0-成功，其他-失败
  "message": string,   // 消息提示
  "data": T | null     // 业务数据，泛型类型，失败时为 null
}
```

**示例（成功）：**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJI...",
    "email": "user@example.com"
  }
}
```

**示例（失败）：**
```json
{
  "code": -1,
  "message": "邮箱格式不正确",
  "data": null
}
```

### 1.2 通用约定

- **Content-Type**: 所有请求和响应均使用 `application/json`
- **认证方式**: 登录后在请求头添加 `Authorization: Bearer <token>`
- **校验规则**: 使用 Jakarta Validation 进行参数校验，失败返回 HTTP 400
- **错误码规范**:
  - `0`: 成功
  - `-1`: 通用错误
  - `400`: 请求参数错误
  - `401`: 认证失败
  - `409`: 资源冲突（如邮箱已存在）

---

## 2. 认证模块 `/api/auth`


**接口路径**: `POST /api/auth/login`

**功能描述**: 通过邮箱与密码进行登录，返回 JWT Token 与用户基本信息

**请求参数**:

| 字段名 | 类型 | 必填 | 说明 | 校验规则 |
|--------|------|------|------|----------|
| email | string | 是 | 用户邮箱 | 合法邮箱格式 |
| password | string | 是 | 用户密码 | 非空 |

**请求示例**:
```json
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

**响应数据**: `Result<AuthResponse>`

`AuthResponse` 结构：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| token | string | JWT 访问令牌 |
| email | string | 用户邮箱 |
| username | string | 用户名 |
| avatarUrl | string | 头像 URL（可选） |
| bio | string | 个人简介（可选） |

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "email": "user@example.com",
    "username": "user123",
    "avatarUrl": "https://example.com/avatar.png",
    "bio": "Hello, I love notes"
  }
}
```

**错误码**:

| HTTP状态码 | code | message | 说明 |
|-----------|------|---------|------|
| 400 | -1 | 邮箱格式不正确 / 密码不能为空 | 参数校验失败 |
| 401 | -1 | 邮箱或密码错误 | 认证失败 |

---

### 2.2 发送验证码

**接口路径**: `POST /api/auth/send-code`

**功能描述**: 向指定邮箱发送注册用的一次性验证码（6位数字），并在服务端缓存以供后续验证

**请求参数**:

| 字段名 | 类型 | 必填 | 说明 | 校验规则 |
|--------|------|------|------|----------|
| email | string | 是 | 目标邮箱地址 | 合法邮箱格式 |

**请求示例**:
```json
POST /api/auth/send-code
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**响应数据**: `Result<Void>`

**响应示例**:
```json
{
  "code": 0,
  "message": "验证码已发送，请查收邮件",
  "data": null
}
```

**错误码**:

| HTTP状态码 | code | message | 说明 |
|-----------|------|---------|------|
| 400 | -1 | 邮箱格式不正确 / 邮箱不能为空 | 参数校验失败 |

---

### 2.3 用户注册

**接口路径**: `POST /api/auth/register`

**功能描述**: 使用邮箱、验证码与密码注册新用户，注册成功返回 JWT Token 与用户基本信息

**请求参数**:

| 字段名 | 类型 | 必填 | 说明 | 校验规则 |
|--------|------|------|------|----------|
| email | string | 是 | 用户邮箱 | 合法邮箱格式 |
| verifyCode | string | 是 | 验证码 | 6位数字 `^\d{6}$` |
| password | string | 是 | 用户密码 | 包含字母和数字，长度8-20位 `^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{8,20}$` |

**请求示例**:
```json
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "verifyCode": "123456",
  "password": "password123"
}
```

**响应数据**: `Result<AuthResponse>`（同登录接口）

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "email": "user@example.com",
    "username": "user123",
    "avatarUrl": null,
    "bio": null
  }
}
```

**错误码**:

| HTTP状态码 | code | message | 说明 |
|-----------|------|---------|------|
| 400 | -1 | 邮箱/验证码/密码格式不正确 | 参数校验失败 |
| 400 | -1 | 验证码错误或已过期 | 验证码校验失败 |
| 409 | -1 | 邮箱已存在 | 邮箱重复注册 |

---

## 附录

### A. 校验规则参考

| 规则名称 | 正则表达式 | 说明 |
|---------|-----------|------|
| 邮箱格式 | 标准邮箱验证 | 使用 `@Email` 注解 |
| 密码规则 | `^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{8,20}$` | 必须包含字母和数字，长度8-20位 |
| 验证码格式 | `^\d{6}$` | 6位数字 |

### B. cURL 调用示例

**发送验证码**:
```bash
curl -X POST http://localhost:8080/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com"}'
```

**用户注册**:
```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","verifyCode":"123456","password":"password123"}'
```

**用户登录**:
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password123"}'
```

**使用 Token 访问受保护接口**:
```bash
curl -X GET http://localhost:8080/api/protected/resource \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

---

## 更新日志

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-12-05 | 初始版本，包含认证模块三个接口 |

---

**文档维护说明**:
1. 新增接口时，在对应模块下添加子章节，并更新目录
2. 修改接口时，更新对应章节内容并在更新日志中记录
3. 保持表格格式统一，便于阅读和维护
4. 所有示例代码使用 JSON 格式高亮
